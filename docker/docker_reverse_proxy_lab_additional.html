<!DOCTYPE html>
<html>
<head>
<title>docker_reverse_proxy_lab_additional.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="running-docker-continter-in-production">Running Docker continter in Production</h1>
<h2 id="nginx-proxy-manager">Nginx Proxy Manager</h2>
<p><strong>Nginx Proxy Manager</strong> is a simple and powerful tool that provides a web-based interface for managing Nginx reverse proxies, making it easy to set up SSL certificates and manage multiple services.</p>
<hr>
<h3 id="step-1-install-docker-and-docker-compose">Step 1: Install Docker and Docker Compose</h3>
<ol>
<li>
<p>If you don't already have Docker installed, follow the instructions on <a href="https://www.docker.com/get-started">Docker’s website</a>.</p>
</li>
<li>
<p>For Docker Compose, you can check if it's installed by running:</p>
<pre class="hljs"><code><div>docker-compose --version
</div></code></pre>
<p>If not installed, install it by following the official guide <a href="https://docs.docker.com/compose/install/">here</a>.</p>
</li>
</ol>
<h3 id="step-2-create-a-directory-for-nginx-proxy-manager">Step 2: Create a Directory for Nginx Proxy Manager</h3>
<ol>
<li>
<p>Open a terminal and create a new directory to store the Docker Compose configuration:</p>
<pre class="hljs"><code><div>mkdir nginx-proxy-manager
<span class="hljs-built_in">cd</span> nginx-proxy-manager
</div></code></pre>
</li>
</ol>
<h3 id="step-3-create-a-docker-composeyml-file">Step 3: Create a <code>docker-compose.yml</code> File</h3>
<ol>
<li>
<p>Inside the <code>nginx-proxy-manager</code> directory, create a new file named <code>docker-compose.yml</code>:</p>
<pre class="hljs"><code><div>touch docker-compose.yml
</div></code></pre>
</li>
<li>
<p>Open the file with a text editor and add the following configuration:</p>
<pre class="hljs"><code><div><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">app:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">'jc21/nginx-proxy-manager:latest'</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'80:80'</span>        <span class="hljs-comment"># HTTP</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'81:81'</span>        <span class="hljs-comment"># Admin Panel</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'443:443'</span>      <span class="hljs-comment"># HTTPS</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">DB_MYSQL_HOST:</span> <span class="hljs-string">"db"</span>
      <span class="hljs-attr">DB_MYSQL_PORT:</span> <span class="hljs-number">3306</span>
      <span class="hljs-attr">DB_MYSQL_USER:</span> <span class="hljs-string">"npm"</span>
      <span class="hljs-attr">DB_MYSQL_PASSWORD:</span> <span class="hljs-string">"npm_password"</span>
      <span class="hljs-attr">DB_MYSQL_NAME:</span> <span class="hljs-string">"npm"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./data:/data</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./letsencrypt:/etc/letsencrypt</span>

  <span class="hljs-attr">db:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">'mysql:5.7'</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">'root_password'</span>
      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">'npm'</span>
      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">'npm'</span>
      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">'npm_password'</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./mysql:/var/lib/mysql</span>
</div></code></pre>
<p>Here’s what this configuration does:</p>
<ul>
<li><strong>Services</strong>:
<ul>
<li><code>app</code>: This is the Nginx Proxy Manager container.</li>
<li><code>db</code>: A MySQL 5.7 container to handle the database for Nginx Proxy Manager.</li>
</ul>
</li>
<li><strong>Ports</strong>:
<ul>
<li><code>80:80</code>: Maps port 80 for HTTP traffic.</li>
<li><code>81:81</code>: Maps port 81 for accessing the Nginx Proxy Manager admin web interface.</li>
<li><code>443:443</code>: Maps port 443 for HTTPS traffic.</li>
</ul>
</li>
<li><strong>Volumes</strong>:
<ul>
<li><code>./data:/data</code>: Stores Nginx Proxy Manager data on your local machine.</li>
<li><code>./letsencrypt:/etc/letsencrypt</code>: Stores Let's Encrypt SSL certificates.</li>
<li><code>./mysql:/var/lib/mysql</code>: Stores MySQL database files.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="step-4-start-nginx-proxy-manager-using-docker-compose">Step 4: Start Nginx Proxy Manager Using Docker Compose</h3>
<ol>
<li>
<p>Ensure you’re in the <code>nginx-proxy-manager</code> directory where your <code>docker-compose.yml</code> file is located.</p>
</li>
<li>
<p>Run the following command to start the containers:</p>
<pre class="hljs"><code><div>docker-compose up -d
</div></code></pre>
<ul>
<li><code>up</code>: This starts the services defined in your <code>docker-compose.yml</code>.</li>
<li><code>-d</code>: Runs the services in detached mode (in the background).</li>
</ul>
</li>
<li>
<p>Docker Compose will download the required images (if they aren’t already present) and start both the Nginx Proxy Manager and MySQL containers.</p>
</li>
</ol>
<h3 id="step-5-access-the-nginx-proxy-manager-web-interface">Step 5: Access the Nginx Proxy Manager Web Interface</h3>
<ol>
<li>
<p>Open a web browser and navigate to:</p>
<pre class="hljs"><code><div>http://localhost:81
</div></code></pre>
</li>
<li>
<p>You’ll see the Nginx Proxy Manager login page. Use the following default credentials:</p>
<ul>
<li><strong>Email</strong>: <code>admin@example.com</code></li>
<li><strong>Password</strong>: <code>changeme</code></li>
</ul>
</li>
<li>
<p>After logging in, change the admin email and password to something secure.</p>
</li>
</ol>
<h3 id="step-6-add-a-proxy-host">Step 6: Add a Proxy Host</h3>
<ol>
<li>From the Nginx Proxy Manager dashboard, click <strong>Proxy Hosts</strong>.</li>
<li>Click the <strong>Add Proxy Host</strong> button.</li>
<li>Enter the domain or subdomain you want to proxy. For example, if you're running a service at <code>http://your-app:3000</code>, enter <code>your-app.local</code>.</li>
<li>Under the <strong>Forward Hostname / IP</strong> section, enter the IP address or hostname of the service you want to proxy. For instance, <code>your-app</code>.</li>
<li>Under <strong>Forward Port</strong>, enter the port number the service uses (e.g., <code>3000</code> for a service running on port 3000).</li>
<li>Enable <strong>Block Common Exploits</strong> and <strong>Websockets Support</strong> (if needed).</li>
<li>If you have a domain name and want to use HTTPS, go to the <strong>SSL</strong> tab and request a new SSL certificate via Let's Encrypt by checking the <strong>Force SSL</strong> and <strong>Request a new SSL certificate</strong> options.</li>
</ol>
<h3 id="step-7-verify-your-proxy-works">Step 7: Verify Your Proxy Works</h3>
<ol>
<li>Once you've set up a proxy host, you can access your service through the domain or subdomain you configured in the <strong>Add Proxy Host</strong> step.</li>
<li>If you enabled HTTPS and requested a Let's Encrypt SSL certificate, make sure you access the service using <code>https://your-domain.com</code>.</li>
</ol>
<hr>
<h3 id="step-8-managing-nginx-proxy-manager">Step 8: Managing Nginx Proxy Manager</h3>
<p>You can continue to manage your proxy hosts, SSL certificates, and advanced Nginx configurations from the Nginx Proxy Manager admin interface. It also allows you to:</p>
<ul>
<li>View logs.</li>
<li>Monitor SSL certificate renewals.</li>
<li>Set up redirects or advanced proxy settings.</li>
</ul>
<h3 id="example-setting-up-a-proxy-for-a-local-application">Example: Setting Up a Proxy for a Local Application</h3>
<p>Let’s say you’re running a web app locally on port 8080 and want to access it via <code>myapp.local</code>. You’d follow these steps:</p>
<ol>
<li>
<p>Add <code>myapp.local</code> to your computer’s <code>hosts</code> file, pointing to <code>127.0.0.1</code>:</p>
<pre class="hljs"><code><div>127.0.0.1 myapp.local
</div></code></pre>
</li>
<li>
<p>In Nginx Proxy Manager, add a new proxy host:</p>
<ul>
<li><strong>Domain Name</strong>: <code>myapp.local</code></li>
<li><strong>Forward Hostname / IP</strong>: <code>127.0.0.1</code></li>
<li><strong>Forward Port</strong>: <code>8080</code></li>
</ul>
</li>
<li>
<p>After configuring the proxy host, open your browser and visit <code>http://myapp.local</code> to see the application.</p>
</li>
</ol>
<hr>
<h3 id="step-9-stop-and-remove-nginx-proxy-manager-if-needed">Step 9: Stop and Remove Nginx Proxy Manager (if needed)</h3>
<p>To stop the Nginx Proxy Manager containers, run:</p>
<pre class="hljs"><code><div>docker-compose down
</div></code></pre>
<p>This will stop and remove both the Nginx Proxy Manager and MySQL containers, but your data will remain in the volumes (<code>./data</code>, <code>./letsencrypt</code>, and <code>./mysql</code>).</p>
<hr>
<h2 id="caddy">Caddy</h2>
<p><strong>Caddy</strong> is a modern web server that automatically provisions SSL certificates using Let's Encrypt, which makes it very easy to set up secure HTTPS servers.</p>
<h3 id="what-youll-need">What You’ll Need:</h3>
<ul>
<li><strong>Docker</strong> and <strong>Docker Compose</strong> installed.</li>
<li>Basic knowledge of Docker and Docker Compose.</li>
</ul>
<hr>
<h3 id="step-1-install-docker-and-docker-compose">Step 1: Install Docker and Docker Compose</h3>
<ol>
<li><strong>Install Docker</strong>: Follow the instructions on the <a href="https://www.docker.com/get-started">Docker official website</a> if you don't have Docker installed.</li>
<li><strong>Install Docker Compose</strong>: If you don’t have Docker Compose, you can install it following the <a href="https://docs.docker.com/compose/install/">official guide</a>.</li>
<li>Verify that Docker and Docker Compose are installed correctly:<pre class="hljs"><code><div>docker --version
docker-compose --version
</div></code></pre>
</li>
</ol>
<h3 id="step-2-create-a-directory-for-caddy-configuration">Step 2: Create a Directory for Caddy Configuration</h3>
<ol>
<li>Create a new directory where you'll store the Caddy configuration and Docker Compose files:<pre class="hljs"><code><div>mkdir caddy-docker
<span class="hljs-built_in">cd</span> caddy-docker
</div></code></pre>
</li>
</ol>
<h3 id="step-3-create-the-docker-composeyml-file">Step 3: Create the <code>docker-compose.yml</code> File</h3>
<ol>
<li>
<p>Inside the <code>caddy-docker</code> directory, create a <code>docker-compose.yml</code> file:</p>
<pre class="hljs"><code><div>touch docker-compose.yml
</div></code></pre>
</li>
<li>
<p>Open the <code>docker-compose.yml</code> file in your preferred text editor and add the following configuration:</p>
<pre class="hljs"><code><div><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">caddy:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">caddy:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">caddy</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"80:80"</span>    <span class="hljs-comment"># HTTP port</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"443:443"</span>  <span class="hljs-comment"># HTTPS port</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./Caddyfile:/etc/caddy/Caddyfile</span>   <span class="hljs-comment"># Mount the Caddyfile configuration</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./data:/data</span>                        <span class="hljs-comment"># To store certificates</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./config:/config</span>                    <span class="hljs-comment"># Configuration data</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ACME_AGREE=true</span>                     <span class="hljs-comment"># Automatically accept the Let's Encrypt terms</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">caddy_network</span>

  <span class="hljs-attr">whoami:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">traefik/whoami</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">whoami</span>
    <span class="hljs-attr">labels:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"traefik.enable=false"</span>  <span class="hljs-comment"># Disable Traefik routing for this container</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">caddy_network</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">caddy_network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</div></code></pre>
</li>
</ol>
<h3 id="key-points">Key Points:</h3>
<ul>
<li>
<p><strong>Caddy Service</strong>:</p>
<ul>
<li>Uses the official <code>caddy:latest</code> Docker image.</li>
<li>Exposes ports 80 (HTTP) and 443 (HTTPS) for web traffic.</li>
<li>Mounts the <code>Caddyfile</code> configuration file to <code>/etc/caddy/Caddyfile</code> in the container.</li>
<li>Mounts a <code>data</code> volume for storing SSL certificates, so they persist across container restarts.</li>
<li>Sets an environment variable <code>ACME_AGREE=true</code> to automatically accept the Let's Encrypt terms.</li>
</ul>
</li>
<li>
<p><strong>Whoami Service</strong>:</p>
<ul>
<li>This is a simple HTTP service that responds with information about the request. It’s used here as an example application to be served by Caddy.</li>
<li>Disabled Traefik routing by setting the label <code>traefik.enable=false</code>.</li>
</ul>
</li>
<li>
<p><strong>Networks</strong>:</p>
<ul>
<li>Both services are connected to a custom network (<code>caddy_network</code>), allowing Caddy to route traffic to <code>whoami</code>.</li>
</ul>
</li>
</ul>
<h3 id="step-4-create-the-caddy-configuration-file">Step 4: Create the Caddy Configuration File</h3>
<ol>
<li>
<p>Inside the same <code>caddy-docker</code> directory, create a <code>Caddyfile</code> to configure how Caddy should handle incoming traffic. This is where you’ll define routing rules, domains, and SSL configurations.</p>
<pre class="hljs"><code><div>touch Caddyfile
</div></code></pre>
</li>
<li>
<p>Open the <code>Caddyfile</code> in your text editor and add the following content:</p>
<pre class="hljs"><code><div>whoami.local {
    reverse_proxy whoami:80
}
</div></code></pre>
<p>This configuration tells Caddy to listen for requests to <code>whoami.local</code> and reverse proxy those requests to the <strong>whoami</strong> service running on port <code>80</code>.</p>
<blockquote>
<p><strong>Important</strong>: The <code>whoami.local</code> domain will need to be added to your system's <code>hosts</code> file for it to resolve locally.</p>
</blockquote>
</li>
</ol>
<h3 id="step-5-start-caddy-and-the-example-service">Step 5: Start Caddy and the Example Service</h3>
<ol>
<li>
<p>Make sure you are in the directory where the <code>docker-compose.yml</code> and <code>Caddyfile</code> are located.</p>
</li>
<li>
<p>Run the following command to start the services in detached mode:</p>
<pre class="hljs"><code><div>docker-compose up -d
</div></code></pre>
<ul>
<li><code>up</code>: Starts the containers defined in <code>docker-compose.yml</code>.</li>
<li><code>-d</code>: Runs the containers in detached mode (in the background).</li>
</ul>
</li>
<li>
<p>Docker will pull the necessary images and start both the <strong>Caddy</strong> and <strong>whoami</strong> containers.</p>
</li>
</ol>
<h3 id="step-6-edit-the-hosts-file">Step 6: Edit the <code>hosts</code> File</h3>
<p>To access the <code>whoami.local</code> domain, you need to modify your system's <code>hosts</code> file so that <code>whoami.local</code> points to <code>127.0.0.1</code> (localhost).</p>
<ul>
<li>
<p><strong>On Linux or MacOS</strong>:</p>
<ol>
<li>Open the <code>hosts</code> file with a text editor:<pre class="hljs"><code><div>sudo nano /etc/hosts
</div></code></pre>
</li>
<li>Add the following line to the file:<pre class="hljs"><code><div>127.0.0.1 whoami.local
</div></code></pre>
</li>
<li>Save and close the file.</li>
</ol>
</li>
<li>
<p><strong>On Windows</strong>:</p>
<ol>
<li>Open the <code>hosts</code> file located at <code>C:\Windows\System32\drivers\etc\hosts</code> in a text editor (run as Administrator).</li>
<li>Add the following line:<pre class="hljs"><code><div>127.0.0.1 whoami.local
</div></code></pre>
</li>
<li>Save and close the file.</li>
</ol>
</li>
</ul>
<h3 id="step-7-access-the-service-in-a-browser">Step 7: Access the Service in a Browser</h3>
<ol>
<li>
<p>Open your browser and navigate to:</p>
<pre class="hljs"><code><div>http://whoami.local
</div></code></pre>
</li>
<li>
<p>You should see the response from the <strong>whoami</strong> container, which will display basic information about the HTTP request (such as headers, IP, etc.).</p>
</li>
</ol>
<h3 id="step-8-access-the-https-version-optional">Step 8: Access the HTTPS Version (Optional)</h3>
<ol>
<li>
<p>Caddy automatically provisions an SSL certificate for your domain through Let's Encrypt. To access your service securely, visit:</p>
<pre class="hljs"><code><div>https://whoami.local
</div></code></pre>
<p>Caddy will automatically handle the HTTPS configuration, and your connection will be encrypted.</p>
</li>
</ol>
<h3 id="step-9-stopping-the-containers">Step 9: Stopping the Containers</h3>
<p>To stop and remove the containers, run the following command:</p>
<pre class="hljs"><code><div>docker-compose down
</div></code></pre>
<p>This stops the containers and removes them, but it retains the data and configuration for the next time you bring the containers back up.</p>
<h3 id="step-10-restarting-the-containers-optional">Step 10: Restarting the Containers (Optional)</h3>
<p>If you made changes to the <code>Caddyfile</code> or want to restart the services, you can run:</p>
<pre class="hljs"><code><div>docker-compose restart
</div></code></pre>
<p>This restarts the containers without removing them.</p>
<hr>
<h3 id="example-of-a-complete-docker-composeyml-and-caddyfile">Example of a Complete <code>docker-compose.yml</code> and <code>Caddyfile</code></h3>
<p>Here’s the final version of the <code>docker-compose.yml</code> and <code>Caddyfile</code>:</p>
<p><strong><code>docker-compose.yml</code></strong>:</p>
<pre class="hljs"><code><div><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">caddy:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">caddy:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">caddy</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"80:80"</span>    <span class="hljs-comment"># HTTP port</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"443:443"</span>  <span class="hljs-comment"># HTTPS port</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./Caddyfile:/etc/caddy/Caddyfile</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./data:/data</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./config:/config</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ACME_AGREE=true</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">caddy_network</span>

  <span class="hljs-attr">whoami:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">traefik/whoami</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">whoami</span>
    <span class="hljs-attr">labels:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"traefik.enable=false"</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">caddy_network</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">caddy_network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</div></code></pre>
<p><strong><code>Caddyfile</code></strong>:</p>
<pre class="hljs"><code><div>whoami.local {
    reverse_proxy whoami:80
}
</div></code></pre>
<hr>

</body>
</html>
